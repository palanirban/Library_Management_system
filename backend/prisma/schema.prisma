generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  password  String
  role      UserRole @default(USER)
  name      String
  createdAt DateTime @default(now())
}

enum UserRole {
  ADMIN
  USER
}

model Member {
  id         Int      @id @default(autoincrement())
  memberNo   String   @unique
  name       String
  email      String   @unique
  phone      String?
  active     Boolean  @default(true)
  createdAt  DateTime @default(now())
  memberships Membership[]
  loans      Loan[]
}

model Membership {
  id        Int      @id @default(autoincrement())
  memberId  Int
  startDate DateTime
  endDate   DateTime
  status    String
  duration  Int      // months
  member    Member   @relation(fields: [memberId], references: [id])
}

model Book {
  id              Int      @id @default(autoincrement())
  title           String
  author          String
  isbn            String   @unique
  category        String?
  type            String   @default("book") // "book" or "movie"
  serialNo        String?  @unique
  totalCopies     Int      @default(1)
  availableCopies Int      @default(1)
  createdAt       DateTime @default(now())
  loans           Loan[]
}

model Loan {
  id         Int      @id @default(autoincrement())
  bookId     Int
  memberId   Int
  serialNo    String?
  issuedAt    DateTime @default(now())
  dueAt       DateTime
  returnedAt  DateTime?
  remarks     String?
  fineId      Int?     @unique   // <-- add @unique here

  book   Book   @relation(fields: [bookId], references: [id])
  member Member @relation(fields: [memberId], references: [id])
  fine   Fine?  @relation(fields: [fineId], references: [id])
}

model Fine {
  id         Int      @id @default(autoincrement())
  amount     Float
  paid       Boolean  @default(false)
  paidAt     DateTime?
  remarks    String?
  createdAt  DateTime @default(now())
  loan       Loan?
}

model MaintenanceEntry {
  id          Int      @id @default(autoincrement())
  title       String
  description String?
  createdBy   Int
  createdAt   DateTime @default(now())
  // for reports/transactions seeding
}
